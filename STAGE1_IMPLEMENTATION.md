# 第一階段實作說明

## 已完成功能

### 1. 🎨 UI 組件

- ✅ `RelationshipQuestion.vue` - 二階段追問UI組件
  - 倒計時進度條
  - 第一階段：選擇方向（爸爸邊/媽媽邊/配偶邊/子女邊/完全不知道）
  - 第二階段：選擇具體稱謂（根據方向和性別過濾）
  - 確認和跳過按鈕
  - 超時處理

### 2. 🔌 通訊系統

- ✅ WebSocket 事件處理
  - `game:started` - 遊戲開始通知
  - `relationship_question` - 接收關係問題
  - `relationship_answer` - 發送答案
  - `relationship_skip` - 跳過問題
  - `relationship_confirmed` - 關係確認通知
  - `stage_completed` - 階段完成通知

### 3. 🎮 畫面切換

- ✅ 房間頁面 (`pages/room/[id].vue`) 支持多階段切換
  - `waiting` - 等待大廳（GameLobby）
  - `relationship-scan` - 第一階段問題（RelationshipQuestion）
  - 等待其他玩家的過渡畫面

### 4. 🖥️ 服務器端

- ✅ 問題生成邏輯
  - 玩家 < 4：每個玩家詢問所有其他玩家
  - 玩家 ≥ 4：每個玩家詢問3位（簡單隨機，待優化）
- ✅ 問題發送和接收處理
- ✅ 答案記錄和廣播

## 使用流程

### 1. 開始遊戲

```typescript
// 房主點擊"開始遊戲"按鈕
handleStartGame(); // 在 GameLobby 中
```

### 2. 接收問題

```typescript
// 玩家自動接收分配的問題
currentQuestion = {
  questionId: "...",
  askedPlayerId: "...",
  targetPlayerId: "...",
  targetPlayerName: "王小明",
  askedPlayerGender: "male",
};
```

### 3. 回答問題

```typescript
// 第一階段：選擇方向
selectDirection("father"); // 爸爸那邊的人

// 第二階段：選擇具體稱謂
selectRelation("爸爸");

// 確認答案
confirmAnswer(); // 發送答案到服務器
```

## 配色方案

與系統一致的配色：

- 主色：`#8B2635` （深紅色）
- 背景：`#FAF8F3` （米白色）
- 強調色：`#D4AF37` （金色）
- 文字：`#5C2E2E` （深棕色）
- 次要文字：`#8B8278` （灰棕色）

## 待實現功能

### 高優先級

- [ ] 玩家 ≥ 4 時的均勻分布算法
- [ ] 問題完成度追蹤（所有玩家回答完畢後進入下一階段）
- [ ] 答案數據持久化（保存到 gameState）

### 中優先級

- [ ] 關係驗證邏輯（檢查答案一致性）
- [ ] 重連時恢復當前問題狀態
- [ ] 問題計時器同步（服務器端）

### 低優先級

- [ ] 答題進度顯示（X/Y 題已完成）
- [ ] 其他玩家答題狀態提示
- [ ] 答題統計和分析

## 測試建議

### 本地測試

1. 開啟兩個瀏覽器窗口
2. 創建房間並加入2位玩家
3. 房主開始遊戲
4. 觀察問題是否正確發送和顯示
5. 測試答題和跳過功能

### 測試場景

- ✅ 2人遊戲（< 4人策略）
- ✅ 3人遊戲（< 4人策略）
- ⏳ 4人遊戲（= 4人邊界）
- ⏳ 5人遊戲（≥ 4人策略）

## 已知問題

1. ⚠️ 問題發送是一次性全部發送，未實現逐題發送
2. ⚠️ 沒有檢查所有問題是否完成
3. ⚠️ 答案暫時只廣播，未保存到數據結構
4. ⚠️ 性別過濾邏輯在前端，未在服務器端驗證

## 下一步計劃

1. 實現問題隊列管理（逐題發送）
2. 追蹤答題進度並自動進入下一階段
3. 實現答案保存和關係建立邏輯
4. 優化 ≥ 4 人的選擇算法（均勻分布）
