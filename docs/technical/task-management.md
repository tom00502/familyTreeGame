# ä»»å‹™ç®¡ç† (Task Management) - æŠ€è¡“å¯¦ä½œ

> **æ¥­å‹™ç­–ç•¥å±¤** â†’ è«‹æŸ¥é–± [qa_phase2_data_filling.md](../features/qa_phase2_data_filling.md)  
> **è¨ˆåˆ†è¦å‰‡** â†’ è«‹æŸ¥é–± [scoring_system.md](../features/scoring_system.md)

---

## ğŸ—‚ï¸ Task è³‡æ–™çµæ§‹

### TypeScript Interface

```typescript
interface Task {
  id: string; // å”¯ä¸€è­˜åˆ¥ç¢¼
  type:
    | "node_naming" // ç¯€é»å‘½å
    | "attribute_filling" // å±¬æ€§å¡«å……
    | "upward_tracing" // å‘ä¸Šè¿½æº¯
    | "node_convergence" // ç¯€é»åŒ¯èš
    | "age_ordering"; // æ’åºç¢ºèª

  nodeId: string; // ç›®æ¨™ç¯€é» ID
  field?: string; // ç›®æ¨™æ¬„ä½ï¼ˆå±¬æ€§å¡«å……æ™‚ä½¿ç”¨ï¼‰
  priority: number; // ç•¶å‰å„ªå…ˆç´šåˆ†æ•¸ (Priority Score)

  status:
    | "pending" // ç­‰å¾…åˆ†æ´¾
    | "assigned" // å·²åˆ†æ´¾çµ¦ç©å®¶
    | "locked" // ç©å®¶é–å®šä¸­
    | "completed" // å·²å®Œæˆ
    | "skipped" // å·²è·³é
    | "conflict"; // é€²å…¥è¡çªè§£æ±ºæµç¨‹

  assignedTo?: string; // ç•¶å‰è² è²¬ç©å®¶ ID
  skipCount: number; // è¢«è·³éæ¬¡æ•¸
  createdAt: number; // å»ºç«‹æ™‚é–“æˆ³
  updatedAt: number; // æœ€å¾Œæ›´æ–°æ™‚é–“æˆ³
}
```

### ä»»å‹™ç‹€æ…‹æ©Ÿ

```
pending
  â””â”€â–º assigned   (ç³»çµ±æ ¹æ“š Priority Score é¸å‡ºæœ€é«˜åˆ†ç©å®¶æ´¾ç™¼)
        â””â”€â–º locked    (ç©å®¶é–‹å§‹ä½œç­”ï¼Œç™¼é€ task_lock äº‹ä»¶)
              â”œâ”€â–º completed  (ç©å®¶æäº¤ç­”æ¡ˆæˆåŠŸ)
              â”œâ”€â–º skipped    (ç©å®¶é¸æ“‡è·³é â†’ é‡å› pendingï¼ŒskipCount++)
              â””â”€â–º conflict   (æäº¤ç­”æ¡ˆèˆ‡ç¾æœ‰è³‡æ–™è¡çª)
```

---

## ğŸ“Š æ€§èƒ½è¤‡é›œåº¦åˆ†æ

| æ“ä½œ                     | æ™‚é–“è¤‡é›œåº¦     | èªªæ˜                             |
| ------------------------ | -------------- | -------------------------------- |
| è¨ˆç®—å–®å€‹ç©å®¶åˆ°ç¯€é»çš„è·é›¢ | O(V + E)       | BFS éæ­· DAG                     |
| å…¨ç©å®¶å„ªå…ˆç´šè¨ˆç®—         | O(P Ã— (V + E)) | P = ç©å®¶æ•¸ï¼ŒV = ç¯€é»æ•¸ï¼ŒE = é‚Šæ•¸ |
| ä»»å‹™åˆ†æ´¾                 | O(log T)       | T = å¾…æ´¾ä»»å‹™æ•¸ï¼ˆä½¿ç”¨å„ªå…ˆç´šä½‡åˆ—ï¼‰ |
| è¡çªæª¢æ¸¬                 | O(C Ã— V)       | C = å·²ç¢ºèªè¡çªæ•¸                 |

### å„ªåŒ–å»ºè­°

1. **å¿«å–è·é›¢è¨ˆç®—**
   - é è¨ˆç®—å¸¸ç”¨ç¯€é»å°é–“çš„è·é›¢
   - æ–°ç¯€é»æ·»åŠ æ™‚å¢é‡æ›´æ–°

2. **å„ªå…ˆç´šä½‡åˆ— (Heap)**
   - ä½¿ç”¨äºŒå‰å †ç®¡ç†å¾…æ´¾ä»»å‹™
   - O(log T) æ™‚é–“å¿«é€Ÿå–å‡ºæœ€é«˜å„ªå…ˆç´šä»»å‹™

3. **æ‰¹æ¬¡è™•ç†**
   - æ¯ 500ms é€²è¡Œä¸€æ¬¡æ‰¹é‡æ´¾é¡Œ
   - é¿å…é »ç¹çš„ç‹€æ…‹åŒæ­¥

---

## ğŸ—ï¸ å¯¦ä½œæ¨¡çµ„è¡¨

| æ¨¡çµ„             | ä½ç½®                              | è²¬ä»»                           |
| ---------------- | --------------------------------- | ------------------------------ |
| **ä»»å‹™åˆ†æ´¾å™¨**   | `server/utils/taskAssigner.ts`    | è¨ˆç®—å„ªå…ˆç´šã€é¸æ“‡ç©å®¶ã€æ´¾ç™¼ä»»å‹™ |
| **è·é›¢è¨ˆç®—å™¨**   | `server/utils/taskAssigner.ts`    | BFS è¨ˆç®—ç¯€é»é–“è·é›¢             |
| **å„ªå…ˆç´šè©•åˆ†å™¨** | `server/utils/taskAssigner.ts`    | å¤šç¶­åº¦è©•åˆ†èˆ‡æ’åº               |
| **è¡çªæª¢æ¸¬å™¨**   | `server/utils/dagValidator.ts`    | æª¢æ¸¬è³‡æ–™èˆ‡é—œä¿‚è¡çª             |
| **è¨ˆåˆ†ç³»çµ±**     | `server/utils/scoreCalculator.ts` | è¨ˆç®—ç©å®¶åˆ†æ•¸èˆ‡çå‹µ             |
| **ä»»å‹™ç®¡ç†å™¨**   | `server/utils/gameState.ts`       | ç®¡ç†ä»»å‹™ä½‡åˆ—èˆ‡ç‹€æ…‹             |

---

## ğŸ”„ æ´¾é¡Œæµç¨‹ï¼ˆ6 æ­¥é©Ÿï¼‰

```
1. æƒææ‰€æœ‰æœªå®Œæˆçš„è™›æ“¬ç¯€é»
   â†’ ç”¢ç”Ÿå¾…è¾¦ä»»å‹™æ¸…å–®ï¼ˆTask Queueï¼‰

2. å°æ¯å€‹ä»»å‹™ï¼Œéæ­·æ‰€æœ‰åœ¨ç·šç©å®¶
   â†’ è¨ˆç®—æ¯å€‹ã€Œç©å®¶ Ã— ä»»å‹™ã€é…å°çš„ Priority Score

3. é¸å‡ºæœ€é«˜ Priority Score çš„é…å°
   â†’ ç³»çµ±æ´¾ç™¼ä»»å‹™çµ¦å°æ‡‰ç©å®¶

4. ç©å®¶é–å®šä»»å‹™ï¼ˆtask_lock äº‹ä»¶ï¼‰
   â†’ å»£æ’­ä»»å‹™é–å®šç‹€æ…‹çµ¦å…¶ä»–ç©å®¶

5. ç©å®¶æäº¤ç­”æ¡ˆï¼ˆtask_submit äº‹ä»¶ï¼‰
   â†’ é©—è­‰è³‡æ–™ä¸¦æ›´æ–°ç¯€é» / è§¸ç™¼è¡çªè§£æ±º

6. ä»»å‹™å®Œæˆï¼ˆtask_completed äº‹ä»¶ï¼‰
   â†’ æ›´æ–° Priority Scoreï¼ˆContributionScore æ›´æ–°ï¼‰
   â†’ é‡æ–°è¨ˆç®—å¾…è¾¦ä»»å‹™æ¸…å–®
   â†’ é‡è¤‡æ­¥é©Ÿ 2
```

**æ–‡ä»¶ç‰ˆæœ¬**: v1.0  
**å»ºç«‹æ—¥æœŸ**: 2026-02-18  
**ç¶­è­·è€…**: Development Team
